# Tech News Agent - 노드 설계

## 전체 흐름

```
collect_events → normalize_events → evaluate → finalize
                                        ↓
                                    (재시도 로직)
                                        ↓
                                  collect_events
```

---

## 1. collect_events

### 목적
다양한 소스에서 최신의 원시(raw) 기술 뉴스 이벤트를 수집

### 입력 (GraphState)
- `tech`: 수집할 기술 스택 (Tech enum)
- `today`: 오늘 날짜 (ISO format: YYYY-MM-DD)

### 출력 (GraphState)
- `raw_events`: 수집된 원시 이벤트 리스트 (List[RawEvent])

### 동작 방식
- **ReAct 패턴** 사용: LLM 에이전트가 자율적으로 도구를 선택하여 실행
- **사용 가능한 도구**:
  1. `fetch_rss()`: RSS 피드에서 블로그 포스트와 기사 수집
  2. `fetch_github_releases()`: GitHub 릴리스 정보 수집
  3. `search_tavily(query)`: Tavily 검색으로 웹 뉴스 수집
  4. `finish_collection(reason)`: 수집 완료 신호

---

## 2. normalize_events (데이터 정규화 노드)

### 목적
서로 다른 형식의 원시 이벤트를 통일된 형식으로 변환

### 입력 (GraphState)
- `raw_events`: 수집된 원시 이벤트 리스트

### 출력 (GraphState)
- `events`: 정규화된 이벤트 리스트 (List[NormalizedEvent])


---

## 3. evaluate (평가 노드)

### 목적
정규화된 이벤트들의 품질과 관련성을 평가

### 입력 (GraphState)
- `events`: 정규화된 이벤트 리스트
- `tech`: 대상 기술 스택
- `attempt`: 현재 시도 횟수
- `max_attempts`: 최대 시도 횟수

### 출력 (GraphState)
- `evaluation`: 평가 결과
  - `pass_`: 품질 기준 통과 여부 (bool)
  - `feedback`: 피드백 메시지 (str)
- `attempt`: 증가된 시도 횟수

### 동작 방식
- **품질 기준 검사**:
  1. 이벤트 개수가 충분한가? (예: 최소 5개 이상)
  2. 다양한 소스에서 수집되었는가? (최소 2개 소스)
  3. 기술 스택과 관련성이 있는가?
  4. 최신 정보인가? (오늘 날짜 기준)

- **평가 결과**:
  - `pass_ = True`: finalize 노드로 이동
  - `pass_ = False`:
    - `attempt < max_attempts`: collect_events로 재시도
    - `attempt >= max_attempts`: finalize로 이동 (실패 처리)


---

## 4. finalize (최종 결과 생성 노드)

### 목적
수집된 이벤트를 기반으로 최종 뉴스레터/리포트 생성

### 입력 (GraphState)
- `events`: 정규화된 이벤트 리스트
- `evaluation`: 평가 결과
- `tech`: 대상 기술 스택
- `today`: 오늘 날짜

### 출력 (GraphState)
- `final_answer`: 최종 생성된 뉴스레터 (str)

### 동작 방식
1. **성공 케이스** (`evaluation.pass_ = True`):
   - 이벤트들을 분석하고 요약
   - Markdown 형식의 뉴스레터 생성
   - 카테고리별로 정리 (릴리스, 블로그 포스트, 뉴스 등)

2. **실패 케이스** (`evaluation.pass_ = False`):
   - 수집 실패 메시지 생성
   - 실패 원인 설명

### 최종 결과 형식 (예시)
```markdown
# Spring 기술 뉴스 - 2025-12-20

## 릴리스
- Spring Boot 3.2.0 released
  - 주요 변경사항...

## 블로그 포스트
- New features in Spring Framework 7
  - 요약...

## 🔍 최근 소식
- ...
```


---

## State 전체 구조

```python
class GraphState(TypedDict, total=False):
    # Input
    tech: Tech                              # 대상 기술 스택
    today: str                              # 오늘 날짜

    # Loop control
    attempt: int                            # 현재 시도 횟수
    max_attempts: int                       # 최대 시도 횟수

    # Data
    raw_events: List[RawEvent]              # 원시 이벤트
    events: List[NormalizedEvent]           # 정규화된 이벤트

    # Evaluation
    evaluation: Evaluation                  # 평가 결과

    # Output
    final_answer: str                       # 최종 결과

    # Error tracking
    errors: List[str]                       # 에러 목록
```


